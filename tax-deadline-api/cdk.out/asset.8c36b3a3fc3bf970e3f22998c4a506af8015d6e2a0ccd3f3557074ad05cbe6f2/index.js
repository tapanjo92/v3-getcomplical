"use strict";var c=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var L=(t,o)=>{for(var r in o)c(t,r,{get:o[r],enumerable:!0})},D=(t,o,r,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of C(o))!w.call(t,a)&&a!==r&&c(t,a,{get:()=>o[a],enumerable:!(n=f(o,a))||n.enumerable});return t};var S=t=>D(c({},"__esModule",{value:!0}),t);var q={};L(q,{handler:()=>E});module.exports=S(q);var y=require("@aws-sdk/client-dynamodb"),d=require("@aws-sdk/lib-dynamodb"),g=new y.DynamoDBClient({region:"ap-south-1"}),T=d.DynamoDBDocumentClient.from(g),h=process.env.DEADLINES_TABLE,E=async t=>{let o=Date.now();console.log("Search deadlines event:",JSON.stringify(t,null,2));let r=t.queryStringParameters?.q?.toLowerCase(),n=t.queryStringParameters?.from,a=t.queryStringParameters?.to;if(!r)return{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:{code:"MISSING_PARAMETER",message:'Query parameter "q" is required'}})};try{let i=(await T.send(new d.ScanCommand({TableName:h,FilterExpression:"begins_with(SK, :prefix)",ExpressionAttributeValues:{":prefix":"DEADLINE#"}}))).Items||[];i=i.filter(e=>{let s=e.data||{};return[s.name?.toLowerCase(),s.description?.toLowerCase(),s.type?.toLowerCase(),s.authority?.toLowerCase(),e.SK.toLowerCase()].filter(Boolean).join(" ").includes(r)}),(n||a)&&(i=i.filter(e=>{let s=e.data?.dueDate||e.data?.dates?.dueDate;return!(!s||n&&s<n||a&&s>a)})),i.sort((e,s)=>{let m=(e.data?.name?.toLowerCase().includes(r)?2:0)+(e.data?.type?.toLowerCase().includes(r)?1:0);return(s.data?.name?.toLowerCase().includes(r)?2:0)+(s.data?.type?.toLowerCase().includes(r)?1:0)-m});let u=i.map(e=>({id:e.data?.id||`${e.PK}-${e.SK}`.toLowerCase().replace(/[#]/g,"-"),...e.data,relevanceScore:(e.data?.name?.toLowerCase().includes(r)?2:0)+(e.data?.type?.toLowerCase().includes(r)?1:0)})),p=Date.now()-o;return{statusCode:200,headers:{"Content-Type":"application/json","X-Response-Time":`${p}ms`},body:JSON.stringify({meta:{code:200,executionTimeMs:p,count:u.length},response:{deadlines:u,query:{q:r,from:n,to:a}}})}}catch(l){return console.error("Error searching deadlines:",l),{statusCode:500,headers:{"Content-Type":"application/json","X-Response-Time":`${Date.now()-o}ms`},body:JSON.stringify({error:{code:"INTERNAL_ERROR",message:"Failed to search deadlines",requestId:t.requestContext.requestId}})}}};0&&(module.exports={handler});
