"use strict";var S=Object.create;var i=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var r in t)i(e,r,{get:t[r],enumerable:!0})},p=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of A(t))!C.call(e,o)&&o!==r&&i(e,o,{get:()=>t[o],enumerable:!(n=f(t,o))||n.enumerable});return e};var E=(e,t,r)=>(r=e!=null?S(b(e)):{},p(t||!e||!e.__esModule?i(r,"default",{value:e,enumerable:!0}):r,e)),P=e=>p(i({},"__esModule",{value:!0}),e);var D={};T(D,{handler:()=>N});module.exports=P(D);var u=require("@aws-sdk/client-dynamodb"),y=require("@aws-sdk/lib-dynamodb"),a=E(require("crypto")),w=new u.DynamoDBClient({region:"ap-south-1"}),x=y.DynamoDBDocumentClient.from(w),O=process.env.API_KEYS_TABLE,m={free:1e3,starter:1e4,professional:1e5,business:1e6,enterprise:-1},N=async e=>{console.log("Key generator event:",JSON.stringify(e,null,2));let t;try{t=JSON.parse(e.body||"{}")}catch{return{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:"Invalid request body"})}}let{customerId:r,customerEmail:n,tier:o="free",description:I}=t;if(!r||!n)return{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:"customerId and customerEmail are required"})};try{let s=`td_${a.randomBytes(32).toString("base64url")}`,g=a.createHash("sha256").update(s).digest("hex"),l=a.randomBytes(8).toString("hex"),h=new Date().toISOString(),c=new Date;c.setFullYear(c.getFullYear()+1);let d={PK:`CUSTOMER#${r}`,SK:`APIKEY#${l}`,apiKeyHash:g,customerId:r,customerEmail:n,tier:o,description:I,monthlyLimit:m[o]||m.free,status:"active",createdAt:h,expiresAt:c.toISOString(),lastUsed:null,totalRequests:0};return await x.send(new y.PutCommand({TableName:O,Item:d})),{statusCode:201,headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s,keyId:l,customerId:r,tier:o,monthlyLimit:d.monthlyLimit,expiresAt:d.expiresAt,message:"Store this API key securely. It will not be shown again."})}}catch(s){return console.error("Error generating API key:",s),{statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:"Failed to generate API key"})}}};0&&(module.exports={handler});
